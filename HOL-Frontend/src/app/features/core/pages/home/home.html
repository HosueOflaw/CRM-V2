<div class="min-h-screen bg-gray-50 dark:bg-gray-900 p-6">

  <ng-container *ngIf="!loading; else skeletonTpl">
    <!-- Actual Dashboard Content -->
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
        <span class="inline-block animate-bounce-slow">๐</span> ูุฑุญุจุงู {{ currentUser?.fullName ||
        currentUser?.username }}
      </h1>
      <p class="text-gray-600 dark:text-gray-400 font-medium">
        {{ authService.isAdmin() ? 'ููุญุฉ ุชุญูู ุงููุฏูุฑ' : authService.isSupervisor() ? 'ููุญุฉ ุชุญูู ุงููุดุฑู' : 'ููุญุฉ ุงูุชุญูู
        ุงูุดุฎุตูุฉ' }}
      </p>
    </div>

    <!-- Employee Dashboard -->
    <div *ngIf="authService.isEmployee() && !authService.isSupervisor() && !authService.isAdmin()">
      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Today's Tasks -->
        <div
          class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700/50 hover:shadow-md transition-shadow">
          <div class="flex items-center justify-between mb-4">
            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-2xl">
              <i class="pi pi-calendar text-2xl text-blue-600 dark:text-blue-400"></i>
            </div>
            <span class="text-4xl font-black text-gray-900 dark:text-white tabular-nums">{{ dashboardStats.todayTasks
              }}</span>
          </div>
          <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">ููุงู ุงูููู</h3>
        </div>

        <!-- Pending Tasks -->
        <div
          class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700/50 hover:shadow-md transition-shadow">
          <div class="flex items-center justify-between mb-4">
            <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-2xl">
              <i class="pi pi-clock text-2xl text-orange-600 dark:text-orange-400"></i>
            </div>
            <span class="text-4xl font-black text-gray-900 dark:text-white tabular-nums">{{ dashboardStats.pendingTasks
              }}</span>
          </div>
          <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">ููุฏ ุงูุงูุชุธุงุฑ</h3>
        </div>

        <!-- In Progress -->
        <div
          class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700/50 hover:shadow-md transition-shadow">
          <div class="flex items-center justify-between mb-4">
            <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-2xl">
              <i class="pi pi-spin pi-spinner text-2xl text-purple-600 dark:text-purple-400"></i>
            </div>
            <span class="text-4xl font-black text-gray-900 dark:text-white tabular-nums">{{
              dashboardStats.inProgressTasks }}</span>
          </div>
          <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">ุฌุงุฑู ุงูุชูููุฐ</h3>
        </div>

        <!-- Completed This Week -->
        <div
          class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700/50 hover:shadow-md transition-shadow">
          <div class="flex items-center justify-between mb-4">
            <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-2xl">
              <i class="pi pi-check-circle text-2xl text-green-600 dark:text-green-400"></i>
            </div>
            <span class="text-4xl font-black text-gray-900 dark:text-white tabular-nums">{{
              dashboardStats.completedThisWeek }}</span>
          </div>
          <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">ููุชููุฉ ูุฐุง ุงูุฃุณุจูุน
          </h3>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Today's Tasks List -->
        <div
          class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-3xl shadow-sm p-8 border border-gray-100 dark:border-gray-700/50">
          <div class="flex items-center justify-between mb-8">
            <h2 class="text-2xl font-black text-gray-900 dark:text-white flex items-center gap-3">
              <span class="p-2 bg-gray-100 dark:bg-gray-700 rounded-xl">๐</span> ููุงู ุงูููู
            </h2>
            <p-button label="ุนุฑุถ ุงููู" icon="pi pi-arrow-left" [text]="true" routerLink="/management/my-tasks"
              severity="secondary"></p-button>
          </div>

          <div *ngIf="todayTasks.length === 0"
            class="flex flex-col items-center justify-center py-16 bg-gray-50/50 dark:bg-gray-800/30 rounded-[2rem] border-2 border-dashed border-gray-200 dark:border-gray-700">
            <div class="text-6xl mb-6">๐</div>
            <h3 class="text-2xl font-black text-gray-900 dark:text-white mb-2">ุนูู ุฑุงุฆุน!</h3>
            <p class="text-gray-500 dark:text-gray-400 text-lg text-center max-w-xs">ููุฏ ุฃูุฌุฒุช ูู ููุงูู ุงูููุฑุฑุฉ ููููู
              ุจูุฌุงุญ.</p>
          </div>

          <div *ngFor="let task of todayTasks"
            class="group mb-6 p-6 bg-white dark:bg-gray-700/40 rounded-2xl border border-gray-100 dark:border-gray-700/50 hover:border-primary/50 hover:shadow-xl hover:shadow-primary/10 transition-all cursor-pointer"
            [routerLink]="['/management/tasks', task.id]">
            <div class="flex items-start justify-between mb-3">
              <h3 class="font-bold text-lg text-gray-900 dark:text-white group-hover:text-primary transition-colors">{{
                task.title }}</h3>
              <p-tag [value]="getStatusLabel(task.status)" [severity]="getStatusSeverity(task.status)" [rounded]="true"
                styleClass="px-3 text-xs"></p-tag>
            </div>
            <p class="text-gray-500 dark:text-gray-400 mb-4 line-clamp-2 leading-relaxed">{{ task.description }}</p>
            <div class="flex items-center gap-4 text-xs font-bold">
              <div class="flex items-center gap-2 text-gray-400">
                <i class="pi pi-calendar"></i>
                <span>{{ task.dueDate | date: 'dd/MM/yyyy' }}</span>
              </div>
              <p-tag [value]="task.priority" [severity]="getPrioritySeverity(task.priority)"
                styleClass="text-[10px] py-0 px-2 uppercase"></p-tag>
            </div>
          </div>
        </div>

        <!-- Sidebar Actions -->
        <div class="space-y-8">
          <!-- Break Status Card -->
          <div
            class="bg-white dark:bg-gray-800 rounded-3xl shadow-sm p-8 border border-gray-100 dark:border-gray-700/50 overflow-hidden relative">
            <div class="absolute -top-10 -right-10 w-32 h-32 bg-primary/5 rounded-full blur-3xl"></div>
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6 relative z-10">โ ุญุงูุฉ ุงูุงุณุชุฑุงุญุฉ</h2>

            <!-- Not Started -->
            <div *ngIf="!isOnBreak && !todayBreakCompleted" class="text-center py-6 relative z-10">
              <div
                class="w-20 h-20 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="pi pi-coffee text-3xl text-gray-400"></i>
              </div>
              <p class="text-gray-500 dark:text-gray-400 mb-6 font-medium">ูุณุช ูู ุงุณุชุฑุงุญุฉ ุญุงููุงู</p>
              <p-button label="ุจุฏุก ุงุณุชุฑุงุญุฉ" icon="pi pi-play" (click)="startBreak()"
                styleClass="w-full h-14 rounded-2xl font-bold shadow-lg shadow-primary/20"></p-button>
            </div>

            <!-- On Break -->
            <div *ngIf="isOnBreak" class="text-center py-6 relative z-10">
              <div
                class="w-24 h-24 bg-orange-50 dark:bg-orange-900/20 rounded-full flex items-center justify-center mx-auto mb-6 border-4 border-orange-100 dark:border-orange-900/20">
                <i class="pi pi-clock text-4xl text-orange-500 animate-pulse"></i>
              </div>
              <p class="text-gray-500 dark:text-gray-400 mb-2">ูุชุจูู ุนูู ุงูุนูุฏุฉ</p>
              <p class="text-4xl font-black text-orange-600 dark:text-orange-400 mb-8 tabular-nums">{{
                breakTimeRemaining }}</p>
              <p-button label="ุฅููุงุก ุงูุงุณุชุฑุงุญุฉ" icon="pi pi-stop" severity="danger" (click)="endBreak()"
                styleClass="w-full h-14 rounded-2xl font-bold shadow-lg shadow-red-500/20"></p-button>
            </div>

            <!-- Completed -->
            <div *ngIf="!isOnBreak && todayBreakCompleted" class="text-center py-6 relative z-10">
              <div
                class="w-20 h-20 bg-green-50 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="pi pi-check-circle text-3xl text-green-500"></i>
              </div>
              <p class="text-green-700 dark:text-green-400 font-bold mb-4">ุชู ุฅุชูุงู ุงุณุชุฑุงุญุฉ ุงูููู ุจูุฌุงุญ โจ</p>
              <p-button label="ุฅุณุชุฑุงุญุฉ ููุชููุฉ" icon="pi pi-check" [disabled]="true"
                styleClass="w-full h-14 rounded-2xl p-button-success p-button-outlined font-bold"></p-button>
            </div>
          </div>

          <!-- Quick Actions -->
          <div
            class="bg-white dark:bg-gray-800 rounded-3xl shadow-sm p-8 border border-gray-100 dark:border-gray-700/50">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">โก ุฑูุงุจุท ุณุฑูุนุฉ</h2>
            <div class="space-y-4">
              <button routerLink="/management/my-tasks"
                class="w-full flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-gray-700/50 hover:bg-primary/5 hover:text-primary transition-all group">
                <div class="flex items-center gap-3">
                  <i class="pi pi-list text-lg text-gray-400 group-hover:text-primary transition-colors"></i>
                  <span class="font-bold">ูุงุฆูุฉ ููุงูู</span>
                </div>
                <i class="pi pi-chevron-left text-xs text-gray-300"></i>
              </button>
              <button routerLink="/management/my-permissions"
                class="w-full flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-gray-700/50 hover:bg-primary/5 hover:text-primary transition-all group">
                <div class="flex items-center gap-3">
                  <i class="pi pi-shield text-lg text-gray-400 group-hover:text-primary transition-colors"></i>
                  <span class="font-bold">ุทูุจ ุตูุงุญูุฉ</span>
                </div>
                <i class="pi pi-chevron-left text-xs text-gray-300"></i>
              </button>
              <button routerLink="/settings"
                class="w-full flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-gray-700/50 hover:bg-primary/5 hover:text-primary transition-all group">
                <div class="flex items-center gap-3">
                  <i class="pi pi-cog text-lg text-gray-400 group-hover:text-primary transition-colors"></i>
                  <span class="font-bold">ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ</span>
                </div>
                <i class="pi pi-chevron-left text-xs text-gray-300"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Supervisor Dashboard (Similar structure but different stats) -->
    <div *ngIf="authService.isSupervisor() || authService.isAdmin()">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div
          class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700/50 transition-all hover:border-indigo-200 dark:hover:border-indigo-800">
          <div class="flex items-center justify-between mb-4">
            <div class="p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-2xl"><i
                class="pi pi-users text-2xl text-indigo-600 dark:text-indigo-400"></i></div>
            <span class="text-4xl font-black text-gray-900 dark:text-white tabular-nums">{{ teamStats.activeEmployees
              }}</span>
          </div>
          <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">ุงูููุธููู ุงููุดุทูู</h3>
        </div>
        <div
          class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700/50 transition-all hover:border-orange-200 dark:hover:border-orange-800">
          <div class="flex items-center justify-between mb-4">
            <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-2xl"><i
                class="pi pi-coffee text-2xl text-orange-600 dark:text-orange-400"></i></div>
            <span class="text-4xl font-black text-gray-900 dark:text-white tabular-nums">{{ teamStats.employeesOnBreak
              }}</span>
          </div>
          <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">ูู ุงุณุชุฑุงุญุฉ</h3>
        </div>
        <div
          class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700/50 transition-all hover:border-emerald-200 dark:hover:border-emerald-800">
          <div class="flex items-center justify-between mb-4">
            <div class="p-4 bg-emerald-50 dark:bg-emerald-900/20 rounded-2xl"><i
                class="pi pi-check-square text-2xl text-emerald-600 dark:text-emerald-400"></i></div>
            <span class="text-4xl font-black text-gray-900 dark:text-white tabular-nums">{{ teamStats.activeTasks
              }}</span>
          </div>
          <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">ุงูููุงู ุงูุฌุงุฑูุฉ</h3>
        </div>
        <div
          class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700/50 transition-all hover:border-rose-200 dark:hover:border-rose-800">
          <div class="flex items-center justify-between mb-4">
            <div class="p-4 bg-rose-50 dark:bg-rose-900/20 rounded-2xl"><i
                class="pi pi-bell text-2xl text-rose-600 dark:text-rose-400"></i></div>
            <span class="text-4xl font-black text-gray-900 dark:text-white tabular-nums">{{ teamStats.pendingRequests
              }}</span>
          </div>
          <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">ุทูุจุงุช ูุนููุฉ</h3>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <div
          class="h-44 bg-gradient-to-br from-indigo-500 to-indigo-700 rounded-3xl p-8 text-white relative overflow-hidden group cursor-pointer shadow-lg shadow-indigo-500/20"
          routerLink="/management/tasks">
          <div
            class="absolute -right-4 -bottom-4 text-8xl opacity-10 transform group-hover:scale-110 transition-transform tracking-wider">
            โ</div>
          <h3 class="text-2xl font-black mb-2">ุฅูุดุงุก ูููุฉ</h3>
          <p class="text-indigo-100 mb-6 max-w-[150px]">ุฅุณูุงุฏ ูุชูุฒูุน ุงูููุงู ุนูู ุงููุฑูู</p>
          <i class="pi pi-arrow-left mt-auto"></i>
        </div>
        <div
          class="h-44 bg-gradient-to-br from-emerald-500 to-emerald-700 rounded-3xl p-8 text-white relative overflow-hidden group cursor-pointer shadow-lg shadow-emerald-500/20"
          routerLink="/management/team-performance">
          <div
            class="absolute -right-4 -bottom-4 text-8xl opacity-10 transform group-hover:scale-110 transition-transform tracking-wider">
            ๐</div>
          <h3 class="text-2xl font-black mb-2">ุงูุฃุฏุงุก</h3>
          <p class="text-emerald-100 mb-6 max-w-[150px]">ุชุญููู ููุชุงุจุนุฉ ุฃุฏุงุก ุฃุนุถุงุก ุงููุฑูู</p>
          <i class="pi pi-arrow-left mt-auto"></i>
        </div>
        <div
          class="h-44 bg-gradient-to-br from-rose-500 to-rose-700 rounded-3xl p-8 text-white relative overflow-hidden group cursor-pointer shadow-lg shadow-rose-500/20"
          routerLink="/management/pending-permissions">
          <div
            class="absolute -right-4 -bottom-4 text-8xl opacity-10 transform group-hover:scale-110 transition-transform tracking-wider">
            ๐ก๏ธ</div>
          <h3 class="text-2xl font-black mb-2">ุงูุตูุงุญูุงุช</h3>
          <p class="text-rose-100 mb-6 max-w-[150px]">ูุฑุงุฌุนุฉ ุทูุจุงุช ุงูุตูุงุญูุงุช</p>
          <i class="pi pi-arrow-left mt-auto"></i>
        </div>
      </div>
    </div>

    <!-- Departments Section -->
    <div class="mt-12" *ngIf="filteredDepartments.length > 0">
      <h2 class="text-xl font-black text-gray-900 dark:text-white mb-8 flex items-center gap-3">
        <span class="p-2 bg-primary/10 rounded-xl text-primary"><i class="pi pi-compass"></i></span>
        ุงูุฃูุณุงู ูุงูุฎุฏูุงุช
      </h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div *ngFor="let dep of filteredDepartments" [routerLink]="dep.route"
          class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700/50 cursor-pointer hover:-translate-y-2 hover:shadow-xl hover:shadow-primary/5 transition-all group">
          <div class="flex items-center gap-4">
            <div
              class="text-3xl p-3 bg-gray-50 dark:bg-gray-700 group-hover:bg-primary/10 group-hover:scale-110 transition-all rounded-xl">
              {{ dep.icon }}
            </div>
            <div>
              <h2 class="font-bold text-gray-900 dark:text-white group-hover:text-primary transition-colors">{{ dep.name
                }}</h2>
              <span class="text-[10px] text-gray-400 uppercase font-bold tracking-widest text-[10px]">ุนุฑุถ ุงููุณู</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Skeleton Template -->
  <ng-template #skeletonTpl>
    <div class="max-w-7xl mx-auto space-y-12 animate-pulse">
      <!-- Header Skeleton -->
      <div>
        <p-skeleton width="18rem" height="3.5rem" styleClass="mb-4 rounded-2xl"></p-skeleton>
        <p-skeleton width="12rem" height="1.5rem" styleClass="rounded-lg"></p-skeleton>
      </div>

      <!-- Stats Grid Skeleton -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div *ngFor="let i of [1,2,3,4]"
          class="bg-white dark:bg-gray-800 p-8 rounded-3xl border border-gray-100 dark:border-gray-700/50">
          <div class="flex justify-between items-center mb-6">
            <p-skeleton size="4.5rem" styleClass="rounded-2xl"></p-skeleton>
            <p-skeleton width="3.5rem" height="3.5rem" styleClass="rounded-xl"></p-skeleton>
          </div>
          <p-skeleton width="7rem" height="1rem" styleClass="rounded-lg"></p-skeleton>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main List Skeleton -->
        <div
          class="lg:col-span-2 bg-white dark:bg-gray-800 p-8 rounded-3xl border border-gray-100 dark:border-gray-700/50">
          <div class="flex justify-between mb-10">
            <p-skeleton width="14rem" height="2.5rem" styleClass="rounded-xl"></p-skeleton>
            <p-skeleton width="6rem" height="2rem" styleClass="rounded-lg"></p-skeleton>
          </div>
          <div *ngFor="let i of [1,2,3]" class="mb-6 p-6 border border-gray-50 dark:border-gray-700/50 rounded-2xl">
            <div class="flex justify-between mb-4">
              <p-skeleton width="50%" height="1.5rem" styleClass="rounded-lg"></p-skeleton>
              <p-skeleton width="5rem" height="1.5rem" styleClass="rounded-full"></p-skeleton>
            </div>
            <p-skeleton width="100%" height="1rem" styleClass="mb-3 rounded-lg"></p-skeleton>
            <p-skeleton width="80%" height="1rem" styleClass="mb-5 rounded-lg"></p-skeleton>
            <div class="flex gap-4">
              <p-skeleton width="6rem" height="1rem" styleClass="rounded-lg"></p-skeleton>
              <p-skeleton width="4rem" height="1rem" styleClass="rounded-lg"></p-skeleton>
            </div>
          </div>
        </div>

        <!-- Sidebar Skeleton -->
        <div class="space-y-8">
          <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl border border-gray-100 dark:border-gray-700/50">
            <p-skeleton width="9rem" height="2rem" styleClass="mb-10 rounded-xl"></p-skeleton>
            <div class="flex flex-col items-center">
              <p-skeleton size="7rem" shape="circle" styleClass="mb-8"></p-skeleton>
              <p-skeleton width="100%" height="3.5rem" styleClass="rounded-2xl"></p-skeleton>
            </div>
          </div>
          <div
            class="bg-white dark:bg-gray-800 p-8 rounded-3xl border border-gray-100 dark:border-gray-700/50 space-y-4">
            <p-skeleton width="10rem" height="1.5rem" styleClass="mb-6 rounded-lg"></p-skeleton>
            <p-skeleton width="100%" height="4.5rem" styleClass="rounded-2xl"></p-skeleton>
            <p-skeleton width="100%" height="4.5rem" styleClass="rounded-2xl"></p-skeleton>
            <p-skeleton width="100%" height="4.5rem" styleClass="rounded-2xl"></p-skeleton>
          </div>
        </div>
      </div>

      <!-- Grid Skeleton -->
      <div>
        <p-skeleton width="12rem" height="2.5rem" styleClass="mb-8 rounded-xl"></p-skeleton>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
          <div *ngFor="let i of [1,2,3,4,5,6,7,8]"
            class="bg-white dark:bg-gray-800 p-6 rounded-2xl border border-gray-100 dark:border-gray-700/50">
            <div class="flex items-center gap-4">
              <p-skeleton size="4rem" styleClass="rounded-xl"></p-skeleton>
              <div class="space-y-3 flex-1">
                <p-skeleton width="70%" height="1.2rem" styleClass="rounded-lg"></p-skeleton>
                <p-skeleton width="40%" height="0.6rem" styleClass="rounded-lg"></p-skeleton>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</div>