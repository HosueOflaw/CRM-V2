<div class="page-header flex justify-between items-center mb-6">
    <div>
        <h1 class="text-2xl font-bold text-gray-800">أداء الموظفين وإدارة الصلاحيات</h1>
        <p class="text-gray-500 mt-1" *ngIf="isAdmin">عرض جميع الموظفين والمشرفين بالشركة</p>
        <p class="text-gray-500 mt-1" *ngIf="isSupervisor">عرض موظفي قسمك الحاليين</p>
    </div>

    <div *ngIf="isSupervisor">
        <button (click)="delModal.open()"
            class="px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl shadow-lg hover:shadow-purple-500/20 transition-all flex items-center gap-2">
            <i class="pi pi-user-plus"></i>
            <span>تفويض صلاحية جديدة</span>
        </button>
    </div>
</div>

<div class="card bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
    <p-table [value]="users" [loading]="loading" [rowHover]="true" styleClass="p-datatable-sm"
        responsiveLayout="scroll">
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="fullName">الاسم <p-sortIcon field="fullName"></p-sortIcon></th>
                <th pSortableColumn="department">القسم <p-sortIcon field="department"></p-sortIcon></th>
                <th pSortableColumn="role">الدور <p-sortIcon field="role"></p-sortIcon></th>
                <th>الصلاحيات</th>
                <th class="text-center">إجراءات</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-user>
            <tr>
                <td class="font-medium">{{ user.fullName || user.username }}</td>
                <td>
                    <span class="px-2 py-1 rounded bg-gray-100 text-gray-600 text-xs">
                        {{ user.department || 'غير محدد' }}
                    </span>
                </td>
                <td>
                    <span [class]="'px-2 py-1 rounded text-xs font-bold ' + 
            (user.role?.toLowerCase()?.includes('admin') ? 'bg-red-50 text-red-600' : 
             user.role?.toLowerCase()?.includes('supervisor') ? 'bg-purple-50 text-purple-600' : 
             'bg-blue-50 text-blue-600')">
                        {{ user.role }}
                    </span>
                </td>
                <td class="text-xs text-gray-600">
                    {{ getPermissionsDisplay(user) }}
                </td>
                <td class="text-center">
                    <button (click)="openDelegateModal(user.id)"
                        class="p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors"
                        title="تفويض صلاحية">
                        <i class="pi pi-key"></i>
                    </button>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="5" class="text-center p-4 text-gray-500">
                    لا يوجد بيانات للعرض حالياً.
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<app-delegate-permission-modal #delModal></app-delegate-permission-modal>