<!-- ================================
   صفحة تقرير عرض بيانات زين (20 شهر)
================================ -->

<div class="p-4 md:p-6 bg-gray-50 min-h-screen" dir="rtl">

  <h1 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">
    تقرير عرض البيانات زين (تقارير الدفعات)
  </h1>

  <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-4 bg-white p-4 rounded-xl shadow-lg">

    <!-- التاريخ -->
    <div class="flex flex-col">
      <label class="font-bold text-sm text-gray-700 mb-1">حتى تاريخ</label>
      <input
        type="date"
        [ngModel]="endDate()"
        (ngModelChange)="endDate.set($event)"
        class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer"
      />
    </div>

    <!-- الشركة (DropDown من الداتا بيز) -->
    <div class="flex flex-col">
      <label class="font-bold text-sm text-gray-700 mb-1">الشركة</label>
      <select
        [ngModel]="company()"
        (ngModelChange)="company.set($event)"
        class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2
               focus:ring-indigo-500 bg-white cursor-pointer"
      >
        <option value="" disabled selected>اختر الشركة</option>

        @for (c of companies; track c.value) {
          <option [value]="c.value">{{ c.label }}</option>
        }
      </select>
    </div>

    <!-- زر تحميل التقرير -->
    <div class="col-span-2 md:col-span-2 flex items-end justify-start md:justify-end mt-4 md:mt-0">
      <button
        (click)="loadReports()"
        class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg shadow-md text-sm font-semibold">
        تحميل تقرير الدفعات (20 شهرًا)
      </button>
    </div>

  </div>

  <!-- جدول التقرير -->
  @if (reportData().length) {
    <div class="mt-6 overflow-x-auto bg-white shadow-lg rounded-xl border border-gray-200">
      <table class="w-full text-right border-collapse text-sm">

        <thead>
          <tr class="bg-indigo-50 text-indigo-700 border-b border-gray-300 font-semibold">
            <th class="p-3 border-l">الاسم</th>
            <th class="p-3 border-l">الإطار</th>
            <th class="p-3 border-l">رقم الهوية</th>
            <th class="p-3 border-l">إجمالي المدفوع</th>
            <th class="p-3 border-l">إجمالي المستحق</th>
            <th class="p-3 border-l">تاريخ الإصدار</th>
            <th class="p-3 border-l">عدد الدفعات</th>

            @for (header of monthlyHeaders(); track header) {
              <th class="p-3 border-l min-w-[120px]">{{ header }}</th>
            }
          </tr>
        </thead>

        <tbody>
          @for (row of reportData(); track row.numberID) {
            <tr class="border-b border-gray-100 hover:bg-gray-50 transition">

              <td class="p-3 border-l font-medium">{{ row.name }}</td>
              <td class="p-3 border-l text-center">{{ row.theFrame }}</td>
              <td class="p-3 border-l text-center">{{ row.numberID }}</td>

              <td class="p-3 border-l text-center font-bold text-green-600">{{ row.totalPaid | number }}</td>
              <td class="p-3 border-l text-center font-bold text-red-600">{{ row.dueAmount | number }}</td>

              <td class="p-3 border-l text-center">{{ row.dateOfIssue }}</td>
              <td class="p-3 border-l text-center">{{ row.batches }}</td>

              @for (header of monthlyHeaders(); track header) {
                <td class="p-3 border-l text-center">
                  @if (row.monthlyPayments[header]) {
                    <div class="text-xs font-semibold">
                      {{ row.monthlyPayments[header].value | number }}
                      <span class="text-gray-500">
                        ({{ row.monthlyPayments[header].percentage }}%)
                      </span>
                    </div>
                  } @else {
                    <span class="text-gray-400">-</span>
                  }
                </td>
              }

            </tr>
          }
        </tbody>

      </table>
    </div>
  } @else {
    <div class="mt-6 p-10 bg-white text-center text-gray-500 rounded-xl shadow">
      اضغط على زر "تحميل تقرير الدفعات" لعرض البيانات.
    </div>
  }






</div>



